{% extends 'main/base.html' %}

{% block title %}{{ package.name }} - æ½›æ°´å¥—ç¥¨ç®¡ç†ç³»çµ±{% endblock %}

{% block extra_css %}
<style>
    .breadcrumb {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e0e0e0;
    }
    
    .breadcrumb a {
        color: #fbb700;
        text-decoration: none;
        font-weight: bold;
    }
    
    .breadcrumb a:hover {
        text-decoration: underline;
    }
    
    .package-hero {
        margin-bottom: 30px;
    }
    
    .package-hero-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 0px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    
    .package-header {
        margin: 25px 0 25px 230px;
    }
    
    .package-title {
        font-size: 2.5em;
        color: #f17431;
        margin-bottom: 10px;
        text-align: left;
    }
    
    .package-subtitle {
        font-size: 1.3em;
        color: #666;
        margin-bottom: 20px;
        text-align: left;
    }
    
    .badges {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        justify-content: flex-start;
    }
    
    .badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.95em;
        font-weight: bold;
    }
    
    .badge-type {
        background: #fbb700;
        color: white;
    }
    
    .badge-city {
        background: #e3f2fd;
        color: #1976d2;
    }
    
    .badge-country {
        background: #f3e5f5;
        color: #7b1fa2;
    }
    
    .badge-featured {
        background: #ffd700;
        color: #333;
    }
    
    .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 25px;
        justify-content: flex-start;
    }
    
    .tag {
        padding: 6px 14px;
        border-radius: 15px;
        font-size: 0.9em;
        color: white;
        font-weight: 500;
    }
    
    .info-section {
        background: white;
        padding: 25px;
        border-radius: 10px;

    }
    
    .info-section h2 {
        color: #fbb700;
        font-size: 1.8em;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 3px solid #fbb700;
    }
    
    /* å½©è‰²æ¨™é¡Œæ¬„æ¨£å¼ */
    .colored-section {
        background: white;
        border-radius: 0px;
        margin-bottom: 25px;
        overflow: hidden;
    }
    
    .colored-section-header {
        padding: 15px 25px;
        color: white;
        font-size: 1.5em;
        font-weight: bold;
        margin: 0;
    }
    
    .colored-section-header.yellow {
        background: #FBB700;
    }
    
    .colored-section-header.orange {
        background: #F17431;
    }
    
    .colored-section-content {
        padding: 25px;
        line-height: 1.8;
        color: #333;
    }
    
    .colored-section-content ul {
        margin: 0;
        padding-left: 20px;
    }
    
    .colored-section-content li {
        margin-bottom: 8px;
    }
    
    .info-content {
        line-height: 1.8;
        color: #333;
        white-space: normal;
    }
    
    /* èª¿æ•´å¯Œæ–‡æœ¬æ®µè½é–“è·ä¸¦ç§»é™¤ç©ºæ®µè½é€ æˆçš„éå¤§ç©ºç™½ */
    .info-content p {
        margin: 0 0 10px;
    }
    .info-content p:last-child {
        margin-bottom: 0;
    }
    .info-content p:empty {
        display: none;
    }
    .info-content p:has(> br:only-child) {
        display: none;
    }
    
    .info-content img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 15px 0;
    }
    
    .info-content table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
    }
    
    .info-content table th,
    .info-content table td {
        padding: 12px;
        border: 1px solid #ffae00;
        text-align: left;
    }
    
    .info-content table th {
        background: #fbb700;
        color: white;
        font-weight: bold;
    }
    
    .info-content table tr:nth-child(even) {
        background: white;
    }
    
    .hotel-section {
        margin-top: 30px;
    }
    
    .hotel-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .hotel-card {
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s;
    }
    
    .hotel-card:hover {
        border-color: #fbb700;
        box-shadow: 0 5px 15px rgba(251, 183, 0, 0.3);
    }
    
    .hotel-image {
        width: 100%;
        height: 180px;
        object-fit: cover;
        background: linear-gradient(135deg, #fbb700 0%, #f89c00 100%);
    }
    
    .hotel-body {
        padding: 15px;
    }
    
    .hotel-name {
        font-size: 1.2em;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
    }
    
    .hotel-website {
        color: #fbb700;
        text-decoration: none;
        font-size: 0.9em;
    }
    
    .hotel-website:hover {
        text-decoration: underline;
    }
    
    .meta-info {
        background: #e3f2fd;
        padding: 20px;
        border-radius: 10px;
        margin-top: 30px;
    }
    
    .meta-info p {
        margin: 8px 0;
        color: #555;
    }
    
    .meta-info strong {
        color: #1976d2;
    }
    
    .action-buttons {
        margin-top: 30px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .json-data {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 20px;
        border-radius: 10px;
        overflow-x: auto;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
        line-height: 1.6;
        white-space: pre-wrap;
    }
    
    .no-content {
        color: #999;
        font-style: italic;
        padding: 20px;
        text-align: center;
    }
    
    /* å·¦å´å°èˆªé¸å–® */
    .side-nav {
        position: sticky;
        top: 20px;
        float: left;
        width: 200px;
        margin-right: 30px;
        margin-bottom: 30px;
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 0px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    /* ä¸»å…§å®¹å€åŒ…è£ */
    .content-wrapper {
        overflow: hidden;
    }
    
    .main-content {
        margin-left: 230px;
    }
    
    .side-nav-item {
        display: block;
        padding: 15px 20px;
        color: #333;
        text-decoration: none;
        border-bottom: 1px solid #e0e0e0;
        transition: all 0.3s;
        font-size: 0.95em;
        background: white;
    }
    
    .side-nav-item:hover {
        background: #f8f9fa;
        color: #fbb700;
    }
    
    .side-nav-item.active {
        background: #fbb700;
        color: white;
        font-weight: bold;
    }
    
    .side-nav-register {
        background: #f17431;
        padding: 15px 20px;
        text-align: center;
    }
    
    .side-nav-register .btn {
        width: 100%;
        text-align: center;
        padding: 0;
        font-size: 0.95em;
        background: transparent;
        color: white;
        box-shadow: none;
    }
    
    .side-nav-register .btn:hover {
        background: rgba(255,255,255,0.1);
        transform: none;
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 1024px) {
        .side-nav {
            float: none;
            width: 100%;
            margin-right: 0;
            margin-bottom: 20px;
            position: relative;
            top: 0;
        }
        
        .main-content {
            margin-left: 0;
        }
        
        .package-header {
            margin-left: 0;
        }
        
        .package-title,
        .package-subtitle {
            text-align: center;
        }
        
        .badges,
        .tags {
            justify-content: center;
        }
    }

    /* è¡Œå‹•ç‰ˆï¼ˆæ‰‹æ©Ÿï¼‰å„ªåŒ–ï¼šé…’åº—å¡ç‰‡æ›´ç·Šæ¹Šã€å–®æ¬„é¡¯ç¤ºã€è¼ƒå°åœ–ç‰‡é«˜åº¦ */
    @media (max-width: 640px) {
        .hotel-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        .info-section {
            padding-left: 10px;
            padding-right: 10px;
        }
        .hotel-card {
            border-radius: 8px;
        }
        .hotel-image {
            height: 160px;
        }
        .hotel-body {
            padding: 12px;
        }
        .hotel-name {
            font-size: 1.05em;
            margin-bottom: 6px;
        }
        .period-section {
            padding: 14px !important;
            margin-left: -8px;
            margin-right: -8px;
        }
        /* æ‰‹æ©Ÿä¸Šåƒ¹æ ¼æ”¹ç‚ºå–®æ¬„é¡¯ç¤º */
        .room-prices > div {
            grid-template-columns: 1fr !important;
        }
    }
    
    /* å¹³æ»‘æ»¾å‹• */
    html {
        scroll-behavior: smooth;
    }
    
    /* WhatsApp æŸ¥è©¢å€åŸŸ */
    .whatsapp-inquiry {
        background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
        padding: 20px 25px;
        margin: 25px 0 25px 230px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        flex-wrap: wrap;
    }
    
    .whatsapp-inquiry-label {
        color: white;
        font-weight: bold;
        font-size: 1.1em;
    }
    
    .whatsapp-inquiry select {
        padding: 12px 20px;
        border-radius: 8px;
        border: none;
        background: white;
        color: #128C7E;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        min-width: 150px;
        height: 48px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        transition: all 0.3s;
    }
    
    .whatsapp-inquiry select:hover {
        background: #f0f0f0;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .whatsapp-inquiry select:focus {
        outline: none;
        background: #FFD700;
        color: #128C7E;
    }
    
    .whatsapp-btn {
        background: white;
        color: #25D366;
        padding: 12px 24px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        height: 48px;
        border: none;
    }
    
    .whatsapp-btn:hover {
        background: #FFD700;
        color: #128C7E;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .whatsapp-icon {
        font-size: 1.3em;
    }
    
    @media (max-width: 1024px) {
        .whatsapp-inquiry {
            margin-left: 0;
            justify-content: center;
        }
    }
    
    /* å¿«é€Ÿåˆ—å°è¡Œç¨‹æŒ‰éˆ• */
    .print-itinerary-btn {
        background: linear-gradient(135deg, #fbb700 0%, #f89c00 100%);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        border: none;
        font-weight: bold;
        font-size: 1em;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(251, 183, 0, 0.3);
        margin-bottom: 10px;
    }
    
    .print-itinerary-btn:hover {
        background: linear-gradient(135deg, #f89c00 0%, #fbb700 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(251, 183, 0, 0.5);
    }
    
    /* åˆ—å°æ¨£å¼ */
    @media print {
        /* éš±è—æ‰€æœ‰ä¸éœ€è¦åˆ—å°çš„å…ƒç´  */
        .header,
        body > header,
        body > nav,
        body > footer,
        .site-header,
        .site-nav,
        .site-footer,
        .breadcrumb,
        .package-hero,
        .package-header,
        .whatsapp-inquiry,
        .side-nav,
        .badges,
        .tags,
        .meta-info,
        .action-buttons,
        .info-section:not(#daily-itinerary),
        .colored-section,
        .hotel-section,
        .print-itinerary-btn,
        #daily-itinerary > p {
            display: none !important;
        }
        
        /* èª¿æ•´ä¸»å…§å®¹å€åŸŸçš„é‚Šè· */
        .main-content {
            margin-left: 0 !important;
        }
        
        .content-wrapper {
            margin: 0 !important;
        }
        
        /* ç§»é™¤å®¹å™¨çš„æ¨£å¼ */
        .container,
        .content {
            margin: 0 !important;
            padding: 0 !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            max-width: 100% !important;
        }
        
        body {
            background: white !important;
        }
        
        /* åªé¡¯ç¤ºæ¯å¤©è¡Œç¨‹å€å¡Š */
        #daily-itinerary {
            display: block !important;
            page-break-inside: avoid;
        }
        
        /* åˆ—å°æ¨™é¡Œæ¨£å¼ */
        .print-header {
            display: block !important;
        }
        
        .daily-itinerary-item {
            page-break-inside: avoid;
            margin-bottom: 20px !important;
            padding: 15px !important;
            border: 2px solid #333 !important;
        }
        
        /* èª¿æ•´åˆ—å°æ™‚çš„é¡è‰² */
        #daily-itinerary h2 {
            color: #000 !important;
            border-bottom: 3px solid #000 !important;
        }
        
        .daily-itinerary-item h3 {
            color: #000 !important;
            border-bottom: 2px solid #000 !important;
            padding-bottom: 5px;
        }
        
        /* å„ªåŒ–åœ–ç‰‡åˆ—å° */
        .daily-itinerary-item img {
            max-width: 100%;
            page-break-inside: avoid;
        }
        
        /* é é¢è¨­å®š */
        @page {
            margin: 2cm;
        }
    }
    
    /* åˆ—å°æ¨™é¡Œï¼ˆé è¨­éš±è—ï¼Œåªåœ¨åˆ—å°æ™‚é¡¯ç¤ºï¼‰ */
    .print-header {
        display: none;
    }
    
    @media print {
        .print-header {
            display: block;
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #000;
        }
        
        .print-header-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #000;
        }
        
        .print-header-subtitle {
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .print-header-label {
            font-size: 16px;
            color: #666;
            margin-top: 10px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'main:package_list' %}">é¦–é </a> / 
    {% if continent %}
        <a href="{% url 'main:package_list_by_continent' continent.slug %}">{{ continent.name }}</a> / 
    {% endif %}
    {% if country %}
        <a href="{% url 'main:package_list_by_country' continent.slug country.slug %}">{{ country.name }}</a> / 
    {% endif %}
    {% if city %}
        <a href="{% url 'main:package_list_by_city' continent.slug country.slug city.slug %}">{{ city.name }}</a> / 
    {% endif %}
    <span>{{ package.name }}</span>
</div>

<div class="package-hero">
    {% if package.main_image %}
        <img src="{{ package.main_image.url }}" alt="{{ package.name }}" class="package-hero-image">
    {% endif %}
</div>

<div class="package-header">
    <h1 class="package-title">{{ package.name }}</h1>
    {% if package.subtitle %}
        <p class="package-subtitle">{{ package.subtitle }}</p>
    {% endif %}
    
    <div class="badges">
        <span class="badge badge-type">{{ package.package_type.name }}</span>
        {% if package.city %}
            <span class="badge badge-city">ğŸ“ {{ package.city.name }}</span>
            <span class="badge badge-country">ğŸŒ {{ package.city.country.name }}</span>
        {% endif %}
        {% if package.is_featured %}
            <span class="badge badge-featured">â­ ç²¾é¸å¥—ç¥¨</span>
        {% endif %}
    </div>
    
    {% if package.tags.all %}
        <div class="tags">
            {% for tag in package.tags.all %}
                <span class="tag" style="background-color: {{ tag.color }};">
                    {{ tag.name }}
                </span>
            {% endfor %}
        </div>
    {% endif %}
</div>

<!-- WhatsApp æŸ¥è©¢å€åŸŸ -->
<div class="whatsapp-inquiry">
    <span class="whatsapp-inquiry-label">ğŸ’¬ WhatsApp æŸ¥è©¢</span>
    <select id="person-count">
        <option value="1">ä¸€äºº</option>
        <option value="2">äºŒäºº</option>
        <option value="3">ä¸‰äºº</option>
        <option value="4">å››äºº</option>
        <option value="5">äº”äºº</option>
        <option value="6">å…­äºº</option>
        <option value="7">ä¸ƒäºº</option>
        <option value="8">å…«äºº</option>
        <option value="9">ä¹äºº</option>
        <option value="10">åäºº</option>
        <option value="more">åäººä»¥ä¸Š</option>
    </select>
    <a href="#" id="whatsapp-link" class="whatsapp-btn" target="_blank">
        <span class="whatsapp-icon">ğŸ“±</span>
        ç«‹å³æŸ¥è©¢
    </a>
</div>

<div class="content-wrapper">
    <!-- å·¦å´å°èˆªé¸å–® -->
    <nav class="side-nav">
        <a href="#introduction" class="side-nav-item">å¥—ç¥¨ç°¡ä»‹</a>
        <a href="#price-info" class="side-nav-item">åƒ¹éŒ¢åŠå…§å®¹</a>
        <a href="#daily-itinerary" class="side-nav-item">è·¯ç·šè¡Œç¨‹</a>
        <a href="#notices" class="side-nav-item">è·¯ç·šé ˆçŸ¥</a>
        <a href="#print" class="side-nav-item">åˆ—å°</a>
        <a href="#share" class="side-nav-item">æˆ‘è¦åˆ†äº«</a>
        <a href="#other" class="side-nav-item">å…¶ä»–</a>
        <div class="side-nav-register">
            <a href="/admin/main/package/{{ package.id }}/change/" class="btn">ç«‹å³ç™»è¨˜/å ±è¨‚</a>
        </div>
    </nav>

    <div class="main-content">
{% if package.description %}
<div id="introduction" class="info-section">
    <h2>å¥—ç¥¨æè¿°</h2>
    <div class="info-content">
        {{ package.description|safe }}
    </div>
</div>
{% endif %}



{% if package.rich_text_table_one %}
<div class="info-section">
    <h2>é…’åº—/åƒ¹æ ¼è³‡è¨Š</h2>
    <div class="info-content" style="white-space: normal;">
        {{ package.rich_text_table_one|safe }}
    </div>
</div>
{% endif %}

{% if package.periods.all %}
<div id="print" class="hotel-section">
    <div class="info-section">
        <h2>åƒ¹æ ¼</h2>
        {% for period in package.periods.all %}
            {% if period.is_active %}
            <div class="period-section" style="margin-bottom: 30px; border: 2px solid #fbb700; border-radius: 10px; padding: 20px;">
                <h3 style="color: #fbb700; margin-bottom: 15px; font-size: 1.5em;">ğŸ“… {{ period.period_text }}</h3>
                
                {% for hotel in period.hotels.all %}
                    {% if hotel.is_active %}
                    <div style="margin-bottom: 25px; background: #f9f9f9; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #f17431; margin-bottom: 15px; font-size: 1.3em;">ğŸ¨ {{ hotel.hotel_name }}</h4>
                        
                        {% for room_type in hotel.room_types.all %}
                            {% if room_type.is_active %}
                            <div style="margin-bottom: 20px; background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #fbb700;">
                                <h5 style="color: #333; margin-bottom: 12px; font-size: 1.1em;">ğŸ›ï¸ {{ room_type.room_type_name }}</h5>
                                
                                <!-- æˆ¿é–“åœ–ç‰‡ -->
                                {% if room_type.images.all %}
                                <div class="room-images" style="margin-bottom: 15px;">
                                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                                        {% for image in room_type.images.all %}
                                            {% if image.is_active %}
                                            <div style="position: relative;">
                                                <img src="{{ image.image.url }}" 
                                                     alt="{{ image.image_description|default:room_type.room_type_name }}" 
                                                     style="width: 100%; height: 150px; object-fit: cover; border-radius: 6px; cursor: pointer;"
                                                     onclick="window.open('{{ image.image.url }}', '_blank')">
                                                {% if image.image_description %}
                                                <p style="margin-top: 5px; font-size: 0.85em; color: #666; text-align: center;">{{ image.image_description }}</p>
                                                {% endif %}
                                            </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                                
                                <!-- åƒ¹æ ¼è³‡è¨Š -->
                                {% if room_type.prices.all %}
                                <div class="room-prices">
                                    <p style="font-weight: bold; color: #fbb700; margin-bottom: 8px;">ğŸ’° åƒ¹æ ¼ï¼š</p>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                        {% for price in room_type.prices.all %}
                                            {% if price.is_active %}
                                            <div style="background: #fffbf0; padding: 10px; border-radius: 6px; border: 1px solid #fbb700;">
                                                {% if price.price_description %}
                                                <span style="color: #666; margin-right: 10px;">{{ price.price_description }}</span>
                                                {% endif %}
                                                <span style="font-size: 1.1em; font-weight: bold; color: #f17431;">{{ price.price }}</span>
                                            </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                {% else %}
                                <p style="color: #999; font-style: italic;">æš«ç„¡åƒ¹æ ¼è³‡è¨Š</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        {% empty %}
                        <p style="color: #999; font-style: italic; padding: 10px;">æ­¤é…’åº—æš«ç„¡æˆ¿å‹è³‡è¨Š</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                {% empty %}
                <p style="color: #999; font-style: italic; padding: 10px;">æ­¤æœŸé–“æš«ç„¡é…’åº—è³‡è¨Š</p>
                {% endfor %}
            </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}

{% if package.rich_text_table %}
<div class="info-section">
    <h2>å¥—é¤å„ªæƒ åŠäº®é»</h2>
    <div class="info-content" style="white-space: normal;">
        {{ package.rich_text_table|safe }}
    </div>
</div>
{% endif %}

{% if package.rich_text_table_three %}
<div id="itinerary" class="info-section">
    <h2>è¡Œç¨‹</h2>
    <div class="info-content" style="white-space: normal;">
        {{ package.rich_text_table_three|safe }}
    </div>
</div>
{% endif %}

{% if package.daily_itineraries.all %}
<div id="daily-itinerary" class="info-section">
    <!-- åˆ—å°æ¨™é¡Œï¼ˆåªåœ¨åˆ—å°æ™‚é¡¯ç¤ºï¼‰ -->
    <div class="print-header">
        <div class="print-header-title">{{ package.name }}</div>
        {% if package.subtitle %}
        <div class="print-header-subtitle">{{ package.subtitle }}</div>
        {% endif %}
        <div class="print-header-label">â”€â”€ æ¯å¤©è¡Œç¨‹ â”€â”€</div>
    </div>
    
    <h2>æ¯å¤©è¡Œç¨‹</h2>
    <button class="print-itinerary-btn" onclick="printItinerary()">
        <span>ğŸ–¨ï¸</span>
        å¿«é€Ÿåˆ—å°è¡Œç¨‹
    </button>
    <a href="{% url 'main:package_daily_itinerary_pdf' continent.slug country.slug city.slug package.slug %}" class="print-itinerary-btn" style="text-decoration: none; margin-left: 10px;">
        <span>â¬‡ï¸</span>
        ä¸‹è¼‰ PDF è¡Œç¨‹
    </a>
    <p style="color: #666; font-size: 0.9em; margin-bottom: 20px;">
        ğŸ’¡ æç¤ºï¼šå¯ä»¥ä½¿ç”¨ä¸Šæ–¹ã€Œå¿«é€Ÿåˆ—å°è¡Œç¨‹ã€æˆ–ç›´æ¥é»æ“Šã€Œä¸‹è¼‰ PDF è¡Œç¨‹ã€å„²å­˜æª”æ¡ˆ
    </p>
    {% for itinerary in package.daily_itineraries.all %}
        {% if itinerary.is_active %}
        <div class="daily-itinerary-item" style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-left: 4px solid #f17431; border-radius: 4px;">
            <h3 style="color: #f17431; margin-bottom: 15px;">ç¬¬{{ itinerary.day_number }}å¤©ï¼š{{ itinerary.title }}</h3>
            
            {% if itinerary.description %}
            <div style="margin-bottom: 15px; line-height: 1.8;">
                <strong>è¡Œç¨‹æè¿°ï¼š</strong>
                <p style="margin-top: 8px; white-space: pre-wrap;">{{ itinerary.description }}</p>
            </div>
            {% endif %}
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                {% if itinerary.meal_info %}
                <div style="padding: 10px; background: white; border-radius: 4px;">
                    <strong>ğŸ½ï¸ é¤é£Ÿï¼š</strong>{{ itinerary.meal_info }}
                </div>
                {% endif %}
                
                {% if itinerary.accommodation %}
                <div style="padding: 10px; background: white; border-radius: 4px;">
                    <strong>ğŸ¨ ä½å®¿ï¼š</strong>{{ itinerary.accommodation }}
                </div>
                {% endif %}
                
                {% if itinerary.transportation %}
                <div style="padding: 10px; background: white; border-radius: 4px;">
                    <strong>ğŸš— äº¤é€šï¼š</strong>{{ itinerary.transportation }}
                </div>
                {% endif %}
            </div>
            
            {% if itinerary.notes %}
            <div style="padding: 10px; background: #fff3cd; border-left: 3px solid #ffc107; border-radius: 4px; margin-bottom: 15px;">
                <strong>ğŸ“ å‚™è¨»ï¼š</strong>
                <p style="margin-top: 8px; white-space: pre-wrap;">{{ itinerary.notes }}</p>
            </div>
            {% endif %}
            
            {% if itinerary.images.all %}
            <div style="margin-top: 20px;">
                <strong style="display: block; margin-bottom: 10px;">ğŸ“· è¡Œç¨‹ç›¸ç‰‡ï¼š</strong>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                    {% for image in itinerary.images.all %}
                        {% if image.is_active %}
                        <div style="position: relative; overflow: hidden; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            {% if image.is_featured %}
                            <span style="position: absolute; top: 5px; left: 5px; background: #ffd700; color: #333; padding: 3px 8px; border-radius: 3px; font-size: 0.8em; font-weight: bold; z-index: 1;">ä¸»è¦ç›¸ç‰‡</span>
                            {% endif %}
                            <img src="{{ image.image.url }}" alt="{{ image.caption }}" style="width: 100%; height: 200px; object-fit: cover; display: block;">
                            {% if image.caption %}
                            <div style="padding: 8px; background: white; font-size: 0.9em; color: #666;">
                                {{ image.caption }}
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}
    {% endfor %}
</div>
{% endif %}

{% if package.price_include_item %}
<div id="price-info" class="colored-section">
    <h2 class="colored-section-header yellow">å¥—é¤åƒ¹éŒ¢åŒ…æ‹¬</h2>
    <div class="colored-section-content">
        {{ package.price_include_item|safe }}
    </div>
</div>
{% endif %}

{% if package.price_exclude_item %}
<div class="colored-section">
    <h2 class="colored-section-header orange">å¥—é¤åƒ¹éŒ¢ä¸åŒ…æ‹¬</h2>
    <div class="colored-section-content">
        {{ package.price_exclude_item|safe }}
    </div>
</div>
{% endif %}

{% if package.flight_info %}
<div id="notices" class="colored-section">
    <h2 class="colored-section-header yellow">èˆªç­è³‡æ–™</h2>
    <div class="colored-section-content">
        {{ package.flight_info|safe }}
    </div>
</div>
{% endif %}

{% if package.tips %}
<div class="colored-section">
    <h2 class="colored-section-header yellow">é™„è¨»</h2>
    <div class="colored-section-content">
        {{ package.tips|safe }}
    </div>
</div>
{% endif %}



<div id="share" class="meta-info">
    <h3 style="margin-bottom: 15px; color: #1976d2;">ğŸ“‹ å¥—ç¥¨è³‡è¨Š</h3>
    <p><strong>å¥—ç¥¨ IDï¼š</strong>{{ package.id }}</p>
    <p><strong>å¥—ç¥¨ç¨®é¡ï¼š</strong>{{ package.package_type.name }}</p>
    {% if package.city %}
        <p><strong>åŸå¸‚ï¼š</strong>{{ package.city.name }} ({{ package.city.country.name }})</p>
    {% endif %}
    <p><strong>å•Ÿç”¨ç‹€æ…‹ï¼š</strong>{% if package.is_active %}âœ… å·²å•Ÿç”¨{% else %}âŒ æœªå•Ÿç”¨{% endif %}</p>
    <p><strong>ç²¾é¸ç‹€æ…‹ï¼š</strong>{% if package.is_featured %}â­ æ˜¯{% else %}å¦{% endif %}</p>
    <p><strong>å»ºç«‹æ™‚é–“ï¼š</strong>{{ package.created_at|date:"Yå¹´mæœˆdæ—¥ H:i:s" }}</p>
    <p><strong>æ›´æ–°æ™‚é–“ï¼š</strong>{{ package.updated_at|date:"Yå¹´mæœˆdæ—¥ H:i:s" }}</p>
</div>

<div id="other" class="action-buttons">
    {% if city and country and continent %}
        <a href="{% url 'main:package_list_by_city' continent.slug country.slug city.slug %}" class="btn btn-secondary">â† è¿”å› {{ city.name }} åˆ—è¡¨</a>
    {% elif country and continent %}
        <a href="{% url 'main:package_list_by_country' continent.slug country.slug %}" class="btn btn-secondary">â† è¿”å› {{ country.name }} åˆ—è¡¨</a>
    {% elif continent %}
        <a href="{% url 'main:package_list_by_continent' continent.slug %}" class="btn btn-secondary">â† è¿”å› {{ continent.name }} åˆ—è¡¨</a>
    {% else %}
        <a href="{% url 'main:package_list' %}" class="btn btn-secondary">â† è¿”å›åˆ—è¡¨</a>
    {% endif %}
    <a href="/admin/main/package/{{ package.id }}/change/" class="btn">ç·¨è¼¯å¥—ç¥¨</a>
</div>
    </div><!-- .main-content -->
</div><!-- .content-wrapper -->

<script>
// æ»¾å‹•ç›£è½ï¼Œè‡ªå‹•é«˜äº®ç•¶å‰å€å¡Šå°æ‡‰çš„é¸å–®é …
document.addEventListener('DOMContentLoaded', function() {
    const navItems = document.querySelectorAll('.side-nav-item');
    const sections = document.querySelectorAll('[id]');
    
    function highlightNav() {
        let current = '';
        let currentPosition = window.pageYOffset + 200;
        
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (currentPosition >= sectionTop && currentPosition < sectionTop + sectionHeight) {
                current = section.getAttribute('id');
            }
        });
        
        navItems.forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('href') === '#' + current) {
                item.classList.add('active');
            }
        });
    }
    
    window.addEventListener('scroll', highlightNav);
    highlightNav();
    
    // WhatsApp æŸ¥è©¢åŠŸèƒ½
    const personCountSelect = document.getElementById('person-count');
    const whatsappLink = document.getElementById('whatsapp-link');
    const packageName = "{{ package.name|escapejs }}";
    
    // æ•¸å­—è½‰ä¸­æ–‡
    const numberToChinese = {
        '1': 'ä¸€',
        '2': 'äºŒ',
        '3': 'ä¸‰',
        '4': 'å››',
        '5': 'äº”',
        '6': 'å…­',
        '7': 'ä¸ƒ',
        '8': 'å…«',
        '9': 'ä¹',
        '10': 'å',
        'more': 'åäººä»¥ä¸Š'
    };
    
    function updateWhatsAppLink() {
        const personCount = personCountSelect.value;
        const personText = numberToChinese[personCount] || personCount;
        let message = `æˆ‘æƒ³æŸ¥è©¢ ${packageName} å‡ºç™¼äººæ•¸ç‚º`;
        
        if (personCount === 'more') {
            message += personText;
        } else {
            message += personText + 'äºº';
        }
        
        const encodedMessage = encodeURIComponent(message);
        const whatsappUrl = `https://api.whatsapp.com/send?phone=85297986315&text=${encodedMessage}`;
        whatsappLink.href = whatsappUrl;
    }
    
    // åˆå§‹åŒ–é€£çµ
    updateWhatsAppLink();
    
    // ç›£è½ä¸‹æ‹‰é¸å–®è®ŠåŒ–
    personCountSelect.addEventListener('change', updateWhatsAppLink);
});

// å¿«é€Ÿåˆ—å°è¡Œç¨‹åŠŸèƒ½
function printItinerary() {
    window.print();
}
</script>
{% endblock %}

